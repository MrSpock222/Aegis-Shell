<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aegis Shell - Website</title>
    <style>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         AEGIS SHELL - Website Window Styles
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
        background: #242424;
        height: 100vh;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      /* UNPROTECTED STATE - Rote durchlÃ¤ssige Umrandung */
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      
      body.unprotected-window {
        border: 4px solid rgba(255, 68, 68, 0.8);
        box-shadow: 
          inset 0 0 20px rgba(255, 68, 68, 0.3),
          0 0 30px rgba(255, 68, 68, 0.5);
        background: #1a0000;
        animation: unprotected-warning-pulse 2s ease-in-out infinite;
      }

      @keyframes unprotected-warning-pulse {
        0%, 100% { 
          border-color: rgba(255, 68, 68, 0.8);
          box-shadow: 
            inset 0 0 20px rgba(255, 68, 68, 0.3),
            0 0 30px rgba(255, 68, 68, 0.5);
        }
        50% { 
          border-color: rgba(255, 68, 68, 1.0);
          box-shadow: 
            inset 0 0 30px rgba(255, 68, 68, 0.5),
            0 0 50px rgba(255, 68, 68, 0.8);
        }
      }

      /* Warning Banner fÃ¼r ungeschÃ¼tzte Fenster */
      .window-warning-banner {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(90deg, #ff4444, #ff0000, #ff4444);
        color: white;
        text-align: center;
        padding: 0.3rem;
        font-family: 'Orbitron', monospace;
        font-weight: 700;
        font-size: 0.8rem;
        z-index: 10000;
        animation: window-warning-pulse 1.5s ease-in-out infinite;
        text-transform: uppercase;
        letter-spacing: 1px;
        display: none;
      }

      body.unprotected-window .window-warning-banner {
        display: block;
      }

      @keyframes window-warning-pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      /* Navigation Bar Anpassungen fÃ¼r ungeschÃ¼tzte Fenster */
      body.unprotected-window .nav-bar {
        background: rgba(255, 68, 68, 0.2);
        border-bottom: 1px solid #ff4444;
        margin-top: 2rem; /* Platz fÃ¼r Warning Banner */
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         NAVIGATION BAR
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .nav-bar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        height: 50px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 9999;
      }

      .nav-button {
        padding: 0.4rem 0.8rem;
        background: #646cff;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .nav-button:hover {
        background: #535bf2;
        transform: translateY(-1px);
      }

      .url-display {
        flex: 1;
        padding: 0.4rem 0.8rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         LOADING & ERROR STATES  
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        color: rgba(255, 255, 255, 0.8);
        font-size: 1.1rem;
        background: #242424;
      }

      .error {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        color: rgba(255, 255, 255, 0.8);
        text-align: center;
        padding: 2rem;
        background: #242424;
      }

      .error h2 {
        color: #ff6b6b;
        margin-bottom: 1rem;
      }

      .retry-btn {
        margin-top: 1rem;
        padding: 0.75rem 1.5rem;
        background: #646cff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
      }

      .retry-btn:hover {
        background: #535bf2;
      }

      /* Hide nav bar after successful redirect */
      .hide-nav .nav-bar {
        display: none;
      }    </style>  </head>
  <body>
    <!-- Window Warning Banner -->
    <div class="window-warning-banner">
      âš ï¸ UNPROTECTED WINDOW - VISIBLE TO SCREENSHOTS âš ï¸
    </div>
    
    <div class="nav-bar">
      <button class="nav-button" onclick="goHome()">ğŸ  Home</button>
      <button class="nav-button" onclick="refreshPage()">ğŸ”„</button>
      <div class="url-display" id="url-display">Aegis Shell</div>
      <button class="nav-button" onclick="closeWindow()">âœ•</button>
    </div>
    
    <div id="loading" class="loading">
      <div>
        <h2>ğŸš€ Aegis Shell</h2>
        <p>Bereite Website vor...</p>
      </div>
    </div>
    
    <div id="error" class="error" style="display: none;">
      <h2>âš ï¸ Fehler</h2>
      <p id="error-message">Die Website konnte nicht geladen werden.</p>
      <button class="retry-btn" onclick="retryLoad()">Erneut versuchen</button>
    </div>    <script>
      /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         AEGIS SHELL - Website Window Engine  
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
      
      // Core Tauri imports
      const { WebviewWindow } = window.__TAURI__.webviewWindow;
      const { getCurrent } = window.__TAURI__.webviewWindow;
      const { invoke } = window.__TAURI__.core;
      
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // STATE & DOM REFERENCES
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      
      let currentUrl = '';
      let urlDisplay;
      let loadingDiv;
      let errorDiv;
      let errorMessage;
      let hasRedirected = false;

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // SCREENSHOT PROTECTION FOR WEBSITE WINDOWS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      // Enable stealth mode for this website window
      async function enableScreenshotProtection() {
        try {
          const currentWindow = getCurrent();
          const result = await invoke('enable_screenshot_protection', { window: currentWindow });
          console.log('Screenshot protection enabled for website window:', result);
          return true;
        } catch (error) {
          console.error('Failed to enable screenshot protection for website window:', error);
          return false;
        }
      }

      // Check protection status
      async function checkScreenshotProtectionStatus() {
        try {
          const currentWindow = getCurrent();
          const result = await invoke('check_screenshot_protection_status', { window: currentWindow });
          console.log('Website window screenshot protection status:', result);
          return result;
        } catch (error) {
          console.error('Failed to check screenshot protection status for website window:', error);
          return false;
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // DOM INITIALIZATION
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Cache DOM element references
      function initializeElements() {
        urlDisplay = document.getElementById('url-display');
        loadingDiv = document.getElementById('loading');
        errorDiv = document.getElementById('error');
        errorMessage = document.getElementById('error-message');
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // NAVIGATION ENGINE
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      // Navigate to target website with stealth redirect
      // Versteckter redirect mit nav-hide nach kurzer verzÃ¶gerung
      function navigateToWebsite(url) {
        if (hasRedirected) return; // Prevent multiple redirects
        
        currentUrl = url;
        hasRedirected = true;
        
        try {
          const urlObj = new URL(url);
          urlDisplay.textContent = urlObj.hostname;
          
          // Update window title with hostname
          document.title = `Aegis Shell - ${urlObj.hostname}`;
          
          // Hide nav after delay and perform redirect
          setTimeout(() => {
            document.body.classList.add('hide-nav');
            window.location.href = url;
          }, 500);
          
        } catch (error) {
          showError('UngÃ¼ltige URL: ' + url);
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // ERROR HANDLING
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Display error state
      function showError(message) {
        loadingDiv.style.display = 'none';
        errorDiv.style.display = 'flex';
        errorMessage.textContent = message;
        hasRedirected = false;
      }

      // Retry failed navigation
      function retryLoad() {
        if (currentUrl) {
          hasRedirected = false;
          loadingDiv.style.display = 'flex';
          errorDiv.style.display = 'none';
          navigateToWebsite(currentUrl);
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // WINDOW CONTROLS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Refresh current page
      function refreshPage() {
        window.location.reload();
      }      // Navigate back to main Aegis Shell
      async function goHome() {
        try {
          // Create new main window
          const mainWindow = new WebviewWindow('main', {
            url: '/index.html',
            title: 'Aegis Shell',
            width: 1200,
            height: 800,
            center: true,
            resizable: true
          });
          
          // Close current window
          const current = getCurrent();
          await current.close();
        } catch (error) {
          console.error('Error opening home:', error);
        }
      }

      // Close current window
      async function closeWindow() {
        try {
          const current = getCurrent();
          await current.close();
        } catch (error) {
          console.error('Error closing window:', error);
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // URL PARAMETER PROCESSING
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Extract target URL from query parameters
      function getUrlFromQuery() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('url');
      }      

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // WINDOW PROTECTION STATE MONITORING
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Check and update window protection state
      async function checkAndUpdateProtectionState() {
        try {
          // Check global protection state from backend
          const globalProtectionEnabled = await invoke('get_global_protection_state');
          console.log('ğŸ” WEBSITE: Global protection state:', globalProtectionEnabled);
          
          if (!globalProtectionEnabled) {
            // Protection is disabled globally, show warning UI
            document.body.classList.add('unprotected-window');
            console.log('âš ï¸ WEBSITE: Window marked as UNPROTECTED');
          } else {
            // Protection is enabled, remove warning UI
            document.body.classList.remove('unprotected-window');
            console.log('ğŸ›¡ï¸ WEBSITE: Window marked as PROTECTED');
          }
        } catch (error) {
          console.error('âŒ WEBSITE: Failed to check protection state:', error);
          // On error, assume unprotected for safety
          document.body.classList.add('unprotected-window');
        }
      }

      // Listen for protection state changes
      async function setupProtectionStateListener() {
        try {
          // Listen for global protection state changes
          await window.__TAURI__.event.listen('protection-state-changed', (event) => {
            const { enabled } = event.payload;
            console.log('ğŸ”„ WEBSITE: Protection state changed:', enabled);
            
            if (enabled) {
              document.body.classList.remove('unprotected-window');
              console.log('âœ… WEBSITE: Window now PROTECTED');
            } else {
              document.body.classList.add('unprotected-window');
              console.log('âš ï¸ WEBSITE: Window now UNPROTECTED');
            }
          });
        } catch (error) {
          console.error('âŒ WEBSITE: Failed to setup protection listener:', error);
        }
      }

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // WEBSITE WINDOW INITIALIZATION
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      // Main startup sequence for website windows
      window.addEventListener('DOMContentLoaded', async () => {
        initializeElements();

        // ğŸ›¡ï¸ COORDINATED PROTECTION ACTIVATION
        // Koordinierte Schutz-Aktivierung mit Backend
        const enableProtectionCoordinated = async () => {
          console.log('ğŸ›¡ï¸ WEBSITE: Coordinating screenshot protection...');
          
          // Multiple attempts for maximum stability
          for (let attempt = 1; attempt <= 15; attempt++) {
            try {
              await enableScreenshotProtection();
              console.log(`âš¡ WEBSITE PROTECTED! Screenshot protection enabled (attempt ${attempt})`);
              
              // Quick status check
              setTimeout(async () => {
                try {
                  await checkScreenshotProtectionStatus();
                } catch (e) { /* Ignore status errors */ }
              }, 100);
              
              return true;
            } catch (error) {
              if (attempt === 15) {
                console.error('âŒ WEBSITE PROTECTION FAILED after 15 attempts:', error);
              }
            }
            
            // 50ms delay between attempts
            await new Promise(resolve => setTimeout(resolve, 50));
          }
          return false;
        };

        // Start protection activation immediately
        setTimeout(() => enableProtectionCoordinated(), 100);

        // Try to load URL from query parameters
        const urlFromQuery = getUrlFromQuery();
        if (urlFromQuery) {
          // Short delay before navigation
          setTimeout(() => {
            navigateToWebsite(urlFromQuery);
          }, 300);
        } else {
          // No URL provided, show error
          showError('Keine Website-URL angegeben');
        }

        // Listen for navigation events from main app
        window.__TAURI__.event.listen('load-website', (event) => {
          const { url } = event.payload;
          if (url && !hasRedirected) {
            navigateToWebsite(url);
          }
        });

        // Initial protection state check
        checkAndUpdateProtectionState();

        // Setup protection state listener
        setupProtectionStateListener();
      });

      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // EXTERNAL API EXPORTS
      // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      // Export core functions for external use
      window.websiteView = {
        navigateToWebsite,
        refreshPage,
        goHome
      };
    </script>
  </body>
</html>
